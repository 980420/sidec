<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition xmlns="http://www.w3.org/1999/xhtml" 
      xmlns:ui="http://java.sun.com/jsf/facelets" 
      xmlns:h="http://java.sun.com/jsf/html" 
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:s="http://jboss.com/products/seam/taglib"
      xmlns:a="http://richfaces.org/a4j"
      template="#{theme.template}"
      xmlns:rich="http://richfaces.org/rich"
      xmlns:c="http://java.sun.com/jstl/core" >
                
<ui:define name="body" >
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<script type="text/javascript">setContentTitle('Camas por servicios')</script>
	<style type="text/css">.rich-stglpanel-body{padding:0px}</style>
	<style type="text/css">.rich-panel-body{padding:0px}</style>
	<style>
		.functpanelbody{padding:0px;}
		.functpanelbody2{padding:5px;}
		.dr-mpnl-pnl-b{
			padding:1px; 
		}
		.dr-mpnl-pnl{
	   		border: 1px !important; 
	   		border-style :solid !important; 
	   		border-color: #BED6F8 !important;
		}
		.custom-error {
			border: 1px solid #FFCC00;
			padding: 5px;
			background-color: #F0F8FF;
			font-size: 10px;
			font-family: "Verdana";
			position: relative;	left: 5px; top: 5px; 
			margin-right: 10px;
		}	
		.strech{
			width:60%; 
		}
		.nostrech{
			width:1%; 
		}		
	</style>
	<script type="text/javascript" language="javascript">
	// <![CDATA[

	// ]]>
	</script>
	
	<rich:hotKey key="esc" handler="subir()"/>

	<a:form>
	</a:form>
		
	<h:form id="camasForm">
	<a:jsFunction name="subir" ajaxSingle="true" status="funcSelectedStatus"
		reRender="settingsdiv, detailspanelheader, errorOutputPanel, modalpanelsdiv" 
		action="#{camasPorServiciosManager.subir()}">
	</a:jsFunction>
	
	<a:outputPanel ajaxRendered="true" id="errorOutputPanel">
		<s:div style="height:30px;width:100%"
			rendered="#{facesMessages.getCurrentMessagesForControl('error').size() > 0 }">
			<div class="custom-error">
				<rich:message for="error"></rich:message>
			</div>	
		</s:div>
	</a:outputPanel>
	
	<a:status id="timerStatus" rendered="true" forceId="true"
			  onstart="document.body.style.cursor='wait';" 
 			  onstop="document.body.style.cursor='default';">
	</a:status>
	<a:status id="blockingStatus" rendered="true"
			  onstart="document.body.style.cursor='wait'; 
			  			Richfaces.showModalPanel('ajaxLoadingModalBox',{left:1, top:-15});" 
 			  onstop="document.body.style.cursor='default'; 
 			  			Richfaces.hideModalPanel('ajaxLoadingModalBox');">
	</a:status>
	
	<rich:modalPanel id="ajaxLoadingModalBox" minHeight="10" minWidth="10" 
	        height="10" width="10" zindex="2000" >
	</rich:modalPanel> 	
		
	<a:jsFunction name="saveCamasDistribution" ajaxSingle="true" limitToList="true"
		action="#{camasPorServiciosManager.saveCamasDistribution()}">
		<a:actionparam name="changes" assignTo="#{camasPorServiciosManager.camasDistributionChanges}" />
	</a:jsFunction>
	
	<a:keepAlive beanName="camasPorServiciosManager" />
	
	
	<table width="100%" cellpadding="5px" cellspacing="0px" style="vertical-align: top;">
		<tr>

		<td style="vertical-align: top; width: 40%;">
			<rich:panel  bodyClass="functpanelbody2">
				<f:facet name="header" >
					<a:status stopText="Servicios" for="functsstree"
							  startText="Actualizando..." id="funcstatus"></a:status>
				</f:facet>
				<div style="border: 1px;" > 
				<a:region id="functsstree" >
				<a:outputPanel ajaxRendered="true">
				
				<rich:dragIndicator id="treeDragIndicator">
			        <f:facet name="single">
			        	<h:panelGrid columns="2">
				            <h:graphicImage  styleClass="indicatorPicture" value="/{icon}" />
				            <h:outputLabel value="{label}" />
			        	</h:panelGrid>
			        </f:facet>
			        <rich:dndParam name="reject">
			        	no aceptado
			        </rich:dndParam>
				</rich:dragIndicator>
				<div style="position: relative; top:-2px;">
				<s:div style="margin-left:1px; ">
					<h:panelGrid columns="2" cellpadding="0" cellspacing="0">
						<h:graphicImage
							value="/resources/funcionalidadesIcons/configuracion/camas.png"
							height="18" />
						<a:commandLink
							action="#{camasPorServiciosManager.setSelectedItem(null, null)}"
							value="Camas por servicios" style="margin-left:1px;"
							status="funcSelectedStatus" ajaxSingle="true"
							reRender="settingsdiv, errorOutputPanel, detailspanelheader" 
							eventsQueue="camasqueue"
							onmouseup="changeIframeVisibility(false)" 
							timeout="2000" />
					</h:panelGrid>
				</s:div>
				
					<rich:tree  changeExpandListener="#{camasPorServiciosManager.treeBuilder.OnNodeCollapseExpand}"
							value="#{camasPorServiciosManager.treeBuilder.treeData}"
							switchType="ajax" preserveModel="state" preserveDataInRequest="true"
							treeNodeVar="treenode"     dragIndicator="treeDragIndicator"
							style="width:200px"        nodeFace="#{node.toString()}"
							var="node" id="functree"   dropListener="#{camasPorServiciosManager.processDrop}"
							componentState="#{treeStateController.departamentosPorEntidadTreeState}" >
					
						<rich:treeNode type="entidad" 
							icon="#{modulosPorEntidadManager.entidadIcon(node.value)}"
							iconLeaf="#{modulosPorEntidadManager.entidadIcon(node.value)}">
								<a:commandLink value="#{node.value.nombre}"
									status="funcSelectedStatus" 
									ajaxSingle="true" immediate="true"
									event="onclick"
									action="#{camasPorServiciosManager.setSelectedItem(node, treenode)}"
									reRender="errorOutputPanel, settingsdiv, detailspanelheader, modalpanelsdiv" >
								</a:commandLink>
						</rich:treeNode>
						
						<rich:treeNode type="departamento" 
							icon="/resources/modCommon/ubicacionesimages/habitaciones.png"
							iconLeaf="/resources/modCommon/ubicacionesimages/habitaciones.png">
								<h:panelGrid columns="2" cellpadding="0" cellspacing="0">
									<a:commandLink value="#{node.value.departamento.nombre} "
										status="funcSelectedStatus" 
										ajaxSingle="true" immediate="true"
										event="onclick"
										action="#{camasPorServiciosManager.setSelectedItem(node, treenode)}"
										reRender="errorOutputPanel, settingsdiv, detailspanelheader, modalpanelsdiv" >
									</a:commandLink>
								</h:panelGrid>
						</rich:treeNode>
						
						<rich:treeNode type="servicio" acceptedTypes="cama"
							icon="/resources/funcionalidadesIcons/configuracion/funcionalidades.png"
							iconLeaf="/resources/funcionalidadesIcons/configuracion/funcionalidades.png">
								<h:panelGrid columns="2" cellpadding="0" cellspacing="0">
									<a:commandLink value="#{node.value.servicio.nombre} "
										status="funcSelectedStatus" 
										ajaxSingle="true" immediate="true"
										event="onclick"
										action="#{camasPorServiciosManager.setSelectedItem(node, treenode)}"
										reRender="errorOutputPanel, settingsdiv, detailspanelheader, 
												modalpanelsdiv, escoger_ubicacion_panel" >
									</a:commandLink>
								</h:panelGrid>
						</rich:treeNode>

						<rich:treeNode dragType="cama" type="cama"
							icon="/resources/modConfiguracion/camas.png"
							iconLeaf="/resources/modConfiguracion/camas.png">
								<a:commandLink rendered="false" timeout="2000"
									action="#{camasPorServiciosManager.putCamaToModify(node.value)}"
									oncomplete="modifySeletedCama()" ajaxSingle="true"
									view="/modConfiguracion/departamentos/clinicos/home.xhtml"
									style="cursor:pointer;" 
									onclick="this.style.cursor='wait'">
									C#{node.value.tipoCama.codigo}#{node.value.descripcion}								
								</a:commandLink>
								<h:outputLabel value="C#{node.value.tipoCama.codigo}#{node.value.descripcion}"/>
								<rich:dndParam name="label" value="C#{node.value.tipoCama.codigo}#{node.value.descripcion}" />
								<rich:dndParam name="icon"  value="resources/modConfiguracion/camas.png" />
						</rich:treeNode>
				</rich:tree>				
				</div>
				</a:outputPanel>
				</a:region>
				</div>
			</rich:panel>	
		</td>
	
		<td style="vertical-align: top; width: 60%;">
			<a:region >
			<a:outputPanel >
			<rich:panel bodyClass="functpanelbody" id="childfuncspanel">
				<f:facet name="header">
					<s:div id="detailspanelheader">
						<s:div rendered="#{camasPorServiciosManager.selectedItem == null}">
							Entidades
						</s:div>
						<s:div rendered="#{camasPorServiciosManager.selectedItem.toString() == 'entidad'}">
							<h:panelGrid columns="3" cellpadding="0" cellspacing="0">
								<h:graphicImage
									value="#{modulosPorEntidadManager.entidadIcon(camasPorServiciosManager.selectedItem.value)}"
									height="16" width="16" />
								<rich:spacer width="1"/>	
								<h:outputLabel 
									value="#{camasPorServiciosManager.selectedItem.value.nombre}" />
							</h:panelGrid>					
						</s:div>
						<s:div rendered="#{camasPorServiciosManager.selectedItem.toString() == 'departamento'}">
							<h:panelGrid columns="3" cellpadding="0" cellspacing="0">
								<h:graphicImage
									value="/resources/modCommon/ubicacionesimages/habitaciones.png"
									height="16" width="16" />
								<rich:spacer width="3"/>	
								<h:outputLabel 
									value="#{camasPorServiciosManager.selectedItem.value.departamento.nombre}" />
							</h:panelGrid>					
						</s:div>
						<s:div rendered="#{camasPorServiciosManager.selectedItem.toString() == 'servicio'}">
							<h:panelGrid columns="3" cellpadding="0" cellspacing="0">
								<h:graphicImage
									value="/resources/funcionalidadesIcons/configuracion/funcionalidades.png"
									height="16" width="16" />
								<rich:spacer width="3"/>	
								<h:outputLabel 
									value="#{camasPorServiciosManager.selectedItem.value.servicio.nombre}" />
							</h:panelGrid>					
						</s:div>
					</s:div>
				</f:facet>
				
				<a:status id="funcSelectedStatus" forceId="true" 
					  onstart="Richfaces.showModalPanel('ajaxLoadingModalBox',{left:1, top:-15});
					  		   javascript:document.getElementById('camasForm:settsdiv').style.display = 'none';
					  		   javascript:document.getElementById('camasForm:loadingdiv').style.display = ''"
					  onstop="Richfaces.hideModalPanel('ajaxLoadingModalBox');
					  		  javascript:document.getElementById('camasForm:loadingdiv').style.display = 'none';
					  		  javascript:document.getElementById('camasForm:settsdiv').style.display = ''">
				  <f:facet name="start">
				  </f:facet>
			    </a:status>
			    <s:div id="loadingdiv" style="text-align: center; width: 100%; display:none;">
				  <br/>
					 <h:graphicImage url="/resources/icons/default/acciones/loading_small.gif" />
				  <br/><br/>	 
				</s:div>	 
				<s:div id="settsdiv">
			    <s:div id="settingsdiv" style="display: inline;">
					<s:div rendered="#{camasPorServiciosManager.selectedItem == null}">
						<h:dataTable value="#{camasPorServiciosManager.entidades()}"
							var="entidad" border="1" columnClasses="strech, nostrech"
							style="width:100%; text-align:left; border: 1px solid #d0d7e5; border-collapse:collapse;"
							cellspacing="0" cellpadding="0"
							rowClasses="dr-table-firstrow2">											
							<h:column>
								<f:facet name="header">
									<div style="background-color: ##{theme.headercolor}; cursor: default;">Nombre</div>
								</f:facet>
								<h:panelGrid columns="2" cellpadding="0" cellspacing="0">
									<h:graphicImage
										value="#{modulosPorEntidadManager.entidadIcon(entidad)}"
										height="16" width="16" style="margin: 2px 2px 2px 2px;" />
									<a:commandLink 
										ajaxSingle="true"
										reRender="settingsdiv, detailspanelheader" limitToList="true"
										value="#{entidad.nombre}" status="funcSelectedStatus"
										action="#{camasPorServiciosManager.setSelectedItem(entidad)}"
										style="color: #0F5FB9;" 
										timeout="2000" />
								</h:panelGrid>
							</h:column>
						</h:dataTable>
					
					</s:div> 
					
					<s:div rendered="#{camasPorServiciosManager.selectedItem.toString() == 'servicio'}">
					<div align="right"><table style="width: 100%; vertical-align: top;"><tr valign="top"><td align="right">
						<h:panelGrid columns="2" cellpadding="0" cellspacing="0" >
							<h:graphicImage height="12" width="12" style="cursor:pointer;"
								value="/resources/icons/default/acciones/adicionar.png" >
								<a:support event="onclick" limitToList="true"
									reRender="agregar_cama"  
									oncomplete="javascript:Richfaces.showModalPanel('agregar_cama', {width: '166px', height: '96px', 'departamento': '#{departamentosYServiciosManager.selectedItem.value.nombre}' } )" />
							</h:graphicImage>
							<h:outputLink value="#" 
								style="margin-left: 2px; margin-bottom: 4px; margin-top: 2px;" >
								Adicionar cama
								<a:support event="onclick" limitToList="true" ajaxSingle="true"
									reRender="agregar_cama"
									oncomplete="javascript:Richfaces.showModalPanel('agregar_cama', {width: '166px', height: '96px', 'departamento': '#{departamentosYServiciosManager.selectedItem.value.nombre}' } )">
								</a:support>
							</h:outputLink>
						</h:panelGrid>
					  </td></tr></table></div>
					</s:div>
					
					<s:div rendered="#{camasPorServiciosManager.selectedItem.toString() == 'entidad'}">
						<h:dataTable value="#{camasPorServiciosManager.departamentosDeEntidadSeleccionada()}"
							var="dep" border="1" columnClasses="strech, nostrech"
							style="width:100%; text-align:left; border: 1px solid #d0d7e5; border-collapse:collapse;"
							cellspacing="0" cellpadding="0"
							rowClasses="dr-table-firstrow2">											
							<h:column>
								<f:facet name="header">
									<div style="background-color: ##{theme.headercolor}; cursor: default;">Departamentos</div>
								</f:facet>
								<h:panelGrid columns="2" cellpadding="0" cellspacing="0">
									<h:graphicImage
										value="/resources/modCommon/ubicacionesimages/habitaciones.png"
										height="16" width="16" style="margin: 2px 2px 2px 2px;" />
									<a:commandLink 
										ajaxSingle="true"
										reRender="settingsdiv, detailspanelheader" limitToList="true"
										value="#{dep.departamento.nombre}" 
										status="funcSelectedStatus"
										action="#{camasPorServiciosManager.setSelectedItem(dep)}"
										style="color: #0F5FB9;" 
										timeout="2000" />
								</h:panelGrid>
							</h:column>
						</h:dataTable>
					</s:div>	
					
					<s:div rendered="#{camasPorServiciosManager.selectedItem.toString() == 'departamento'}">
						<h:dataTable value="#{camasPorServiciosManager.serviciosDeDepartamentoSeleccionado()}"
							var="serv" border="1" columnClasses="strech, nostrech"
							style="width:100%; text-align:left; border: 1px solid #d0d7e5; border-collapse:collapse;"
							cellspacing="0" cellpadding="0"
							rowClasses="dr-table-firstrow2">											
							<h:column>
								<f:facet name="header">
									<div style="background-color: ##{theme.headercolor}; cursor: default;">Servicios</div>
								</f:facet>
								<h:panelGrid columns="2" cellpadding="0" cellspacing="0">
									<h:graphicImage
										value="/resources/funcionalidadesIcons/configuracion/funcionalidades.png"
										height="16" width="16" style="margin: 2px 2px 2px 2px;"/>
									<a:commandLink 
										ajaxSingle="true"
										reRender="settingsdiv, detailspanelheader, escoger_ubicacion_panel" 
										limitToList="true"	value="#{serv.servicio.nombre}" 
										status="funcSelectedStatus"
										action="#{camasPorServiciosManager.setSelectedItem(serv)}"
										style="color: #0F5FB9;" 
										timeout="2000" />
								</h:panelGrid>
							</h:column>
						</h:dataTable>
						<s:div style="border-left: 1px solid #d0d7e5;
									  border-right: 1px solid #d0d7e5;
									  border-bottom: 1px solid #d0d7e5;"
							rendered="#{camasPorServiciosManager.serviciosDeDepartamentoSeleccionado().size() == 0}">
							<rich:spacer height="10" style="display:block"/>
							<h:outputLabel value="No existe informaci贸n a mostrar." 
							 	style="margin-left:7px;" />
							<rich:spacer height="5" style="display:block"/>
						</s:div>
					</s:div>	
						
					<s:div rendered="#{camasPorServiciosManager.selectedItem.toString() == 'servicio'}">
						<h:dataTable value="#{camasPorServiciosManager.serviciosDeServicioSeleccionado()}"
							var="serv" border="1" columnClasses="strech, nostrech"
							style="width:100%; text-align:left; border: 1px solid #d0d7e5; border-collapse:collapse;"
							cellspacing="0" cellpadding="0"
							rowClasses="dr-table-firstrow2">											
							<h:column>
								<f:facet name="header">
									<div style="background-color: ##{theme.headercolor}; cursor: default;">Servicios</div>
								</f:facet>
								<h:panelGrid columns="2" cellpadding="0" cellspacing="0">
									<h:graphicImage
										value="/resources/funcionalidadesIcons/configuracion/funcionalidades.png"
										height="16" width="16" style="margin: 2px 2px 2px 2px;"/>
									<a:commandLink 
										ajaxSingle="true"
										reRender="settingsdiv, detailspanelheader, escoger_ubicacion_panel" 
										limitToList="true"	value="#{serv.servicio.nombre}" 
										status="funcSelectedStatus"
										action="#{camasPorServiciosManager.setSelectedItem(serv)}"
										style="color: #0F5FB9;" 
										timeout="2000" />
								</h:panelGrid>
							</h:column>
						</h:dataTable>
						<s:div style="border-left: 1px solid #d0d7e5;
									  border-right: 1px solid #d0d7e5;
									  border-bottom: 1px solid #d0d7e5;"
							rendered="#{camasPorServiciosManager.serviciosDeServicioSeleccionado().size() == 0}">
							<rich:spacer height="10" style="display:block"/>
							<h:outputLabel value="No existe informaci贸n a mostrar." 
							 	style="margin-left:7px;" />
							<rich:spacer height="5" style="display:block"/>
						</s:div>
						<br/>
						<h:dataTable value="#{camasPorServiciosManager.camasDeServicioSeleccionado()}"
							var="cma" border="1" columnClasses="strech, strech, nostrech, nostrech"
							style="width:100%; text-align:left; border: 1px solid #d0d7e5; border-collapse:collapse;"
							cellspacing="0" cellpadding="0"
							rowClasses="dr-table-firstrow2">											
							<f:facet name="header">
								<div style="background-color: ##{theme.headercolor}; cursor: default;">Camas</div>
							</f:facet>
							<h:column>
								<f:facet name="header">
									<div style="background-color: ##{theme.headercolor}; cursor: default;">Identificador</div>
								</f:facet>
								<h:panelGrid columns="2" cellpadding="0" cellspacing="0">
									<h:graphicImage
										value="/resources/modConfiguracion/camas.png"
										height="16" width="16" style="margin: 2px 2px 2px 2px;"/>
									<a:commandLink rendered="true" timeout="2000"
										action="#{camasPorServiciosManager.putCamaToModify(cma)}"
										oncomplete="modifySeletedCama()" ajaxSingle="true"
										view="/modConfiguracion/departamentos/clinicos/home.xhtml"
										style="cursor:pointer;" 
										onclick="this.style.cursor='wait'">
										C#{cma.tipoCama.codigo}#{cma.descripcion}								
									</a:commandLink>
								</h:panelGrid>
							</h:column>
							<h:column>
								<f:facet name="header">
									<div style="background-color: ##{theme.headercolor}; cursor: default;">Ubicaci贸n</div>
								</f:facet>
								#{camasPorServiciosManager.camaLocation(cma)}
							</h:column>	
							<h:column>
								<f:facet name="header">
									<div style="background-color: ##{theme.headercolor}; cursor: default; height: 14px;"> </div>
								</f:facet>
							    <div align="center" >
								  	<a:commandLink rendered="true" status="blockingStatus" timeout="2000"
						  				action="#{camasPorServiciosManager.putCamaToModify(cma)}" ajaxSingle="true" 
						  				oncomplete="modifySeletedCama()" onclick="this.style.cursor='wait'"
						  				view="/modConfiguracion/departamentos/clinicos/home.xhtml">
								  		<h:graphicImage style="border:0px; cursor: pointer; margin: 2px 2px 2px 2px;" title="Modificar" 
											url="/resources/icons/default/acciones/modificar.png" >
										</h:graphicImage>
								  	</a:commandLink>
							 	</div>		
							</h:column>							
							<h:column>
								<f:facet name="header">
									<div style="background-color: ##{theme.headercolor}; cursor: default; height: 14px;"> </div>
								</f:facet>
							    <div align="center" >
								  	<a:commandLink rendered="true" status="blockingStatus"
								  				action="#{camasPorServiciosManager.putCamaToDelete(cma)}" ajaxSingle="true" 
												oncomplete="deleteSeletedCama()" onclick="this.style.cursor='wait'"
								  				view="/modConfiguracion/departamentos/clinicos/home.xhtml">
								  		<h:graphicImage style="border:0px; cursor: pointer" title="Eliminar" 
											url="/resources/icons/default/acciones/eliminar.png" >
										</h:graphicImage>
								  	</a:commandLink>
							 	</div>		
							</h:column>							
						</h:dataTable>
						<s:div style="border-left: 1px solid #d0d7e5;
									  border-right: 1px solid #d0d7e5;
									  border-bottom: 1px solid #d0d7e5;"
							rendered="#{camasPorServiciosManager.camasDeServicioSeleccionado().size() == 0}">
							<rich:spacer height="10" style="display:block"/>
							<h:outputLabel value="No existe informaci贸n a mostrar." 
							 	style="margin-left:7px;" />
							<rich:spacer height="5" style="display:block"/>
						</s:div>
					</s:div>	
						
			    </s:div>
			    </s:div>
			</rich:panel>
			</a:outputPanel>
			</a:region>
		</td>
		</tr>
	</table>
	
	<a:jsFunction name="showModalPanelEditarCama" reRender="modalpanelsdiv" 
			limitToList="true" ajaxSingle="true" immediate="true" 
			oncomplete="Richfaces.showModalPanel('editar_cama');">
	</a:jsFunction>



	</h:form>
	

	<script type="text/javascript" language="javascript">
	// <![CDATA[
		function deleteSeletedCama(){
			Richfaces.showModalPanel('eliminar_cama_panel');
		}
		function modifySeletedCama(){
			showModalPanelEditarCama();
		}
	// ]]>
	</script>
	
	<s:div id="modalpanelsdiv" >
	
		<ui:include src="/modConfiguracion/camas/camas_por_servicios/modalpanels/agregar_camas.xhtml" />
	
		<ui:include src="/modConfiguracion/camas/camas_por_servicios/modalpanels/editar_camas.xhtml" />
	
		<ui:include src="/modConfiguracion/camas/camas_por_servicios/modalpanels/confirmar_eliminar_cama.xhtml" />
		
	</s:div>
	
	<ui:include src="/modConfiguracion/camas/camas_por_servicios/modalpanels/ubication_chooser.xhtml" />
	
	<script type="text/javascript" language="javascript">
	// <![CDATA[
		initialVisibility();
	// ]]>
	</script>
	
	<s:span id="error"></s:span>
</ui:define>

</ui:composition>



