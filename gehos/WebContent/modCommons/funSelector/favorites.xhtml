<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:c="http://java.sun.com/jstl/core" template="#{theme.template}">
	<ui:define name="body">

		<style type="text/css">
.borde {
	border: 0px !important;
	background: none !important;
}

.panelRes {
	border: 0px !important;
	width: 122px;
	height: 97px;
	cursor: pointer;
	background: transparent !important;
}

.panelRes:hover {
	background:
		url("#{facesContext.externalContext.requestContextPath}/resources/modCommon/funimages/fondoRes2.png")
		no-repeat !important;
}

.panelRes2 {
	background-image:
		url("#{facesContext.externalContext.requestContextPath}/resources/modCommon/funimages/fondoRes2.png");
	background-repeat: no-repeat;
	border: 0px !important;
	width: 122px;
	height: 97px;
	cursor: pointer;
}

.sele {
	color: #000000 !important;
	font-weight: normal !important;
	border: 0px !important;
}

.dr-mpnl-mask-div {
	background-color: transparent;
}

.dr-mpnl-pnl,.dr-mpnl-shadow,.rich-mpnl-shadow {
	background-color: transparent !important;
	border: 0px !important;
	vertical-align: middle;
}
</style>
		<script type="text/javascript">setContentTitle("#{messages['TITULO']}")
	   function cambia(elemento){
	     elemento.setAttribute("class","dr-pnl rich-panel panelRes2");
	   }
	   function cambia2(elemento){
	     elemento.setAttribute("class","dr-pnl rich-panel panelRes");
	   }
	   </script>

		<a4j:status id="favstatus"
			onstart="moveToCoordinate(); Richfaces.showModalPanel('ajaxLoadingModalBox',{left:100, top:150});"
			onstop="Richfaces.hideModalPanel('ajaxLoadingModalBox');"></a4j:status>

		<script type="text/javascript">
		<!--
			function getScrollingPosition(){
				var position = [0, 0];
				if (typeof window.pageYOffset != 'undefined'){
					position = [window.pageXOffset,window.pageYOffset];
				}
				else if (typeof document.documentElement.scrollTop != 'undefined' 
							 && document.documentElement.scrollTop > 0){
					position = [document.documentElement.scrollLeft, document.documentElement.scrollTop];
				}
				else if (typeof document.body.scrollTop != 'undefined'){
					position = [document.body.scrollLeft,document.body.scrollTop];
				}
				return position;
			}	
			var IE = document.all?true:false;
			var tempX = 0; var tempY = 0;	
			function getMouseXY(e) {
				if (IE) {
				  tempX = event.clientX + document.body.scrollTop;
				  tempY = event.clientY + document.body.scrollLeft;
				} else {  
				  var scrollpos = getScrollingPosition();
				  tempX = e.pageX - scrollpos[0]; 
				  tempY = e.pageY - scrollpos[1];
				}  
			}
			function moveToCoordinate(){
				document.getElementById("favsloadingdiv").style.top = (tempY - 150 - 15) + "px";
				document.getElementById("favsloadingdiv").style.left = (tempX - 100 + 20) + "px";
			}
		-->	
		</script>


		<rich:modalPanel id="ajaxLoadingModalBox" minHeight="700"
			minWidth="900" height="700" width="900" zindex="2000">

			<img id="favsloadingdiv"
				src="#{facesContext.externalContext.requestContextPath}/resources/icons/default/acciones/loading_small.gif"
				style="position: absolute; top: 0px; left: 0px;" />

		</rich:modalPanel>

		<a4j:form status="favstatus">
			<a4j:jsFunction name="removeFuncFromFavorites" ajaxSingle="true"
				action="#{funSelectorController.removeFavorites()}">
				<a4j:actionparam name="funcId"
					assignTo="#{funSelectorController.funcIdToRemove}" />
				<a4j:actionparam name="modName"
					value="#{activeModule.activeModuleName}"
					assignTo="#{funSelectorController.moduleName}" />
			</a4j:jsFunction>
		</a4j:form>

		<script type="text/javascript">
			function removeFromFavorites(img, funcId, e){
				e.cancelBubble = true; 
				img.src = "#{facesContext.externalContext.requestContextPath}/resources/modCommon/actionimages/nofavoritos.png";
				removeFuncFromFavorites(funcId);
			}
		</script>

		<h:form id="favorites_form">
			<a4j:outputPanel ajaxRendered="true">
				<s:div rendered="#{funSelectorController.userFuntions(identity.username).size()==0}"
					style="text-align:center">
                                    #{messages.msg_noExistenElementos_com}
                                </s:div>
				<c:set var="percent" value="100%"></c:set>
				<c:set var="favssize"
					value="#{funSelectorController.userFuntions(identity.username).size()}"></c:set>
				<rich:dataGrid id="favsdatagrid" rendered="#{funSelectorController.userFuntions(identity.username).size()!=0}"
					value="#{funSelectorController.userFuntions(identity.username)}"
					var="fun" columns="4" captionClass="borde" rowClasses="borde"
					columnClasses="borde" styleClass="borde" width="#{percent}">
					<rich:panel styleClass="panelRes" onmousedown="cambia(this)"
						onmouseup="cambia2(this)"
						rendered="#{fun.url.indexOf('selector') > -1}"
						onclick="document.location = '#{facesContext.externalContext.requestContextPath}/modCommons/funSelector/selector.gehos?moduleName=#{activeModule.activeModuleName}#{messages.signo}idFuncionalidad=#{fun.id}#{messages.signo}idancestors=#{funSelectorController.listaAncestros}#{fun.id}a'">
						<div style="float: right;">
							<h:graphicImage
								onclick="removeFromFavorites(this, '#{fun.id}', event)"
								title="#{messages.qfavorito}" style="opacity: 0.4;"
								url="/resources/modCommon/actionimages/favoritos.png"
								rendered="#{not funSelectorController.isNotAlreadyAFavorite(fun, identity.username)}">
								<rich:effect event="onmouseover" type="Opacity"
									params="duration:0.3, from:0.4, to:1.0" />
								<rich:effect event="onmouseout" type="Opacity"
									params="duration:0.3, from:1.0, to:0.4" />
							</h:graphicImage>
						</div>
						<div align="center"
							style="text-align: center; padding-left: 16px;">
							<h:graphicImage
								value="/resources/funcionalidadesIcons/#{funSelectorController.iconsContainer(activeModule.activeModule).nombre}/#{fun.imagen}"
								style="border:0px;" />
						</div>
						<div style="width: 100px; text-align: center;" class="sele">
							<h:outputLabel value="#{fun.label}" />
						</div>
					</rich:panel>
					<rich:panel styleClass="panelRes" onmousedown="cambia(this)"
						onmouseup="cambia2(this)"
						rendered="#{not (fun.url.indexOf('selector') > -1)}"
						onclick="document.location = '#{facesContext.externalContext.requestContextPath}#{menuBuilder.processUrl(fun.url)}?idFuncionalidad=#{fun.id}#{messages.signo}idancestors=#{funSelectorController.listaAncestros}#{fun.id}a'">
						<div style="float: right;">
							<h:graphicImage
								onclick="removeFromFavorites(this, '#{fun.id}', event)"
								title="#{messages.qfavorito}" style="opacity: 0.4;"
								url="/resources/modCommon/actionimages/favoritos.png"
								rendered="#{not funSelectorController.isNotAlreadyAFavorite(fun, identity.username)}">
								<rich:effect event="onmouseover" type="Opacity"
									params="duration:0.3, from:0.4, to:1.0" />
								<rich:effect event="onmouseout" type="Opacity"
									params="duration:0.3, from:1.0, to:0.4" />
							</h:graphicImage>
						</div>
						<div align="center"
							style="text-align: center; padding-left: 16px;">
							<h:graphicImage
								value="/resources/funcionalidadesIcons/#{funSelectorController.iconsContainer(activeModule.activeModule).nombre}/#{fun.imagen}"
								style="border:0px;" />
						</div>
						<div style="width: 100px; text-align: center;" class="sele">
							<h:outputLabel value="#{fun.label}" />
						</div>
					</rich:panel>
				</rich:dataGrid>
				<c:if test="#{not (favssize > 3)}">
					<script type="text/javascript">
         			var perc = #{favssize} * 25;
         			var delta = (#{favssize}==3)? 2 : 4.8;
         			document.getElementById("favorites_form:favsdatagrid").setAttribute("width", perc + delta + "%");
         		</script>
				</c:if>
			</a4j:outputPanel>
		</h:form>

	</ui:define>

</ui:composition>
